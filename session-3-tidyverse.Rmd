---
title: "Session 3 Tasks (tidyverse)"
author: "Andreas Angourakis"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

## Creating, verifying and saving a data frame

Combining the vectors into a data frame

```{r}
stone_tools_data <- data.frame(
  inventory_number = c("LN15", "LN17", "LN18", "LN21", "LN23", "LN24"),
  blength = c(18, 14, 21, 14, 17, 16),
  breadth = c(9, 7, 10, 7, 8, 8),
  thickness = c(3, 2, 3, 3, 3, 2),
  material_type = c("chert", "chert", "obsidian", "chert", "obsidian", "obsidian"),
  material_provenance = c("local", "local", "local", "non-local", "local", "non-local")
)
```

Check that the data and data types are coherent with the specifications. Display the data frame:

```{r}
knitr::kable(stone_tools_data)
```

Save it as a CSV file (stored in a “data” subdirectory). Here we are using `readr::write_csv()` which saves the data frame without an index column. We name the file differently, so we can compare it with the one generated by `read.csv()`. 

```{r}
write_csv(stone_tools_data, "data/stone_tools_data_tidyverse.csv")
```

Load it back as a new R object (e.g. “stone_tools_data2”). No need to skip the index column as with `write.csv()` and `read.csv()`.

```{r}
stone_tools_data2 <- read_csv("data/stone_tools_data_tidyverse.csv")
```

## Chert vs obisidian tools

Create a plot showing the counts of objects made of chert and obsidian. Save it as a PNG file in “plots” subdirectory.

```{r}
plot_name <- "plots/session3_barplot_material_type_tidyverse.png"

png(plot_name)

ggplot(stone_tools_data,
       aes(x = material_type)) +
  geom_bar() +
  labs(title = "Bar Plot of count of artifacts by material type",
       x = "Material type") +
  theme(axis.title = element_text(size = 20),
        axis.text = element_text(size = 20))

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Material type and provenance

Create a new variable (“type_and_provenance”) that combines type and provenance 

```{r}
stone_tools_data <- stone_tools_data %>%
  mutate(type_and_provenance = paste(stone_tools_data$material_type, stone_tools_data$material_provenance, sep = " and "))
```

Create a plot showing the counts in each category. Save it as a PNG file in “plots” subdirectory.

```{r}
plot_name <- "plots/session3_barplot_material_type_and_provenance_tidyverse.png"

png(plot_name, width = 700)

ggplot(stone_tools_data, aes(x = type_and_provenance)) + 
  geom_bar() + 
  labs(title = "Bar plot of Blade Shape", 
       x = "Blade Shape categories") +
  theme(axis.title = element_text(size = 20),
        axis.text = element_text(size = 15))

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Overview of tool dimensions

Create a single figure displaying the variable distribution of the three dimensions measured. Save it as both a PNG and a SVG file in “plots” subdirectory.

```{r}
plot_name <- "plots/session3_histogram_length_breadth_thickness_tidyverse.png"

stone_tools_data_pivot <- stone_tools_data %>% 
  # select only the relevant columns
  select(inventory_number, blength, breadth, thickness) %>%
  # transform data frame into longr format with the columns: inventory_number, name, value
  pivot_longer(cols = -inventory_number) %>%
  # force custom labels into `name` so that our plot display directly these instead of the given variable names
  mutate(name = factor(name, 
                       levels = c("blength", "breadth", "thickness"),
                       labels = c("Length (mm)", "Breadth (mm)", "Thickness (mm)")))

png(plot_name, width = 700, height = 300)

ggplot(stone_tools_data_pivot, aes(x = value)) +
  geom_histogram(bins = 5) +
  facet_wrap(~ name, scales = "free") +
  theme(axis.title = element_text(size = 20),
        axis.text = element_text(size = 15),
        strip.text = element_text(size = 20))

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Length vs breadth

Create a plot displaying the relationship between length and breadth. Save it as a PNG file in “plots” subdirectory.

```{r}
plot_name <- "plots/session3_scatter_length_breadth_tidyverse.png"

png(plot_name, width = 600, height = 400)

ggplot(stone_tools_data, aes(x = blength, y = breadth)) +
  geom_point(size = 5) +
  theme(axis.title = element_text(size = 20),
        axis.text = element_text(size = 15),
        strip.text = element_text(size = 20))

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```

## Length vs breadth vs type-provenance class

Create a plot displaying the relationship between length and breadth, this time marking (point type, colour) objects by their “type_and_provenance”. Save it as both a PNG and a EPS file in “plots” subdirectory.

```{r}
plot_name <- "plots/session3_scatter_length_breadth_type_provenance_tidyverse.png"

png(plot_name, width = 600, height = 400)

ggplot(stone_tools_data, 
       aes(x = blength, y = breadth, 
           colour = type_and_provenance,
           shape = type_and_provenance)) +
  geom_point(size = 5, alpha = 0.8) +
  labs(colour = "Type and provenance", shape = "Type and provenance") +
  theme(axis.title = element_text(size = 20),
        axis.text = element_text(size = 15),
        strip.text = element_text(size = 20))

dev.off()
```

```{r}
knitr::include_graphics(plot_name)
```
